---
import Layout from "../layouts/Layout.astro";
import PlotFigure from "../components/PlotFigure.astro";
import * as Plot from "@observablehq/plot";
import penguins from "../assets/penguins.json";
---

<Layout>
    <div
        class="min-h-screen bg-gradient-to-br from-violet-50 via-purple-50 to-indigo-50 p-8"
    >
        <h1 class="text-4xl font-light text-center mb-8">
            <span
                class="bg-gradient-to-r font-bold from-violet-600 to-purple-600 bg-clip-text text-transparent"
            >
                Graphique filtré des manchots
            </span>
        </h1>

        <div
            class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-violet-100 p-8 max-w-4xl mx-auto"
        >
            <div class="mb-4 text-center">
                <select
                    name="species"
                    id="species"
                    class="px-4 py-2 rounded-lg border border-violet-200 bg-white"
                >
                    <option value="">All species</option>
                    <option value="Adelie">Adelie</option>
                    <option value="Chinstrap">Chinstrap</option>
                    <option value="Gentoo">Gentoo</option>
                </select>
            </div>
            <div id="myplot" class="flex justify-center"></div>
        </div>
    </div>
    <script>
        // Importe la librairie Plot d'ObservableHQ
        import * as Plot from "@observablehq/plot";
        // Importe les données des manchots depuis un fichier JSON
        import penguins from "../assets/penguins.json";

        // Récupère l'élément select pour choisir l'espèce
        const selectSpecies = document.getElementById(
            "species",
        ) as HTMLSelectElement;
        // Fonction pour afficher le graphique
        function renderPlot() {
            // Récupère l'espèce sélectionnée
            const species = selectSpecies.value;

            // Sélectionne la div où le graphique sera affiché
            const div = document.querySelector("#myplot");

            // Vide le contenu précédent de la div
            if (div) {
                div.innerHTML = "";
            }
            // Crée le graphique avec Plot
            const plot = Plot.plot({
                marks: [
                    // Ajoute les points du graphique, filtrés selon l'espèce choisie

                    Plot.dot(penguins, {
                        x: "culmen_length_mm", // Axe X : longueur du bec
                        y: "culmen_depth_mm", // Axe Y : profondeur du bec
                        stroke: "species", // Couleur selon l'espèce
                        // Filtre selon l'espèce sélectionnée
                        filter: species ? (d) => d.species === species : null,
                    }),
                ],
            });
            // Ajoute le graphique à la div
            if (div) {
                div.appendChild(plot);
            }
        }

        // Ajoute un écouteur d'événement pour le changement d'espèce (appel 'renderPlot')
        selectSpecies.addEventListener("change", renderPlot);

        // Affiche le graphique au chargement de la page
        renderPlot();
    </script>
</Layout>
